---
import { getCollection } from 'astro:content';
import '../styles/globals.css';
import { ArticlePage } from '../components/ArticlePage';
import SiteHead from '../components/SiteHead.astro';
import { getTranslations, defaultLocale } from '../i18n/translations';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  const paths = [];
  
  for (const article of articles) {
    const id = article.data.id?.toString() || article.slug;
    const locale = article.data.locale || defaultLocale;
    
    // Only create paths for default locale (ru) - other locales are handled by [locale]/[slug].astro
    if (locale === defaultLocale) {
      paths.push({
        params: { slug: id },
        props: {
          article: {
            id,
            title: article.data.title,
            image: article.data.image,
            tags: Array.isArray(article.data.tags) ? article.data.tags : (article.data.tags ? [article.data.tags] : []),
            date: article.data.date,
            body: article.body,
            slug: id,
            locale: locale,
          },
          locale: locale,
        },
      });
    }
  }
  
  return paths;
}

const { article, locale } = Astro.props;
const currentLocale = locale || article.locale || defaultLocale;
const t = getTranslations(currentLocale as 'ru' | 'lv' | 'en');
---

<html lang={currentLocale} class="">
  <head>
    <SiteHead title={article.title} />
  </head>
  <body class="bg-lightbg dark:bg-darkbg text-lightfg dark:text-darkfg transition-colors">
    <ArticlePage client:load article={article} locale={currentLocale} translations={t} />
  </body>
</html>
